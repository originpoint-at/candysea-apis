syntax = "proto3";

package io.candysea.candymint.v1;

import "api/common/types/chain.proto";
import "google/protobuf/timestamp.proto";

option java_multiple_files = true;
option java_package = "io.candysea.candymint.v1";

service CandyMintService {
  rpc LoginWithWallet (LoginWithWalletRequest) returns (LoginWithWalletResponse) {};
  rpc CreateCollection (CreateCollectionRequest) returns (Collection) {};
  rpc GetCollection (GetCollectionRequest) returns (Collection) {};
  rpc ListCollections (ListCollectionsRequest) returns (ListCollectionsResponse) {};
  rpc UpdateCollection (UpdateCollectionRequest) returns (Collection) {};
  rpc SyncCollectionOnChainData (SyncCollectionOnChainDataRequest) returns (Collection) {};
  rpc ListReleases (ListReleasesRequest) returns (ListReleasesResponse) {};
  rpc ListNFTs (ListNFTsRequest) returns (ListNFTsResponse) {};
  rpc GetNFT (GetNFTRequest) returns (NFT) {};
}

message LoginWithWalletRequest {
  string address = 1;
  string signature = 2;
  string message = 3;
  google.protobuf.Timestamp timestamp = 4;
}

message LoginWithWalletResponse {
  string access_token = 1;
  
  reserved 2;
  reserved "refresh_token";
}

message Collection {
  string id = 1;
  // readonly, generated from display_name
  string name = 2;
  string display_name = 3;
  string description = 4;
  string cover_uri = 5;
  string author = 6;
  string github_repo_uri = 7;
  // readonly
  io.candysea.common.types.Chain chain = 8;
  // readonly
  string contract_address = 9;
  // readonly
  float price = 10;
  // readonly
  int32 supply_count = 11;
  Release latest_release = 12;
  google.protobuf.Timestamp create_time = 13;
  google.protobuf.Timestamp update_time = 14;
}

message Release {
  enum Status {
    STATUS_UNSPECIFIED = 0;
    PROCESSING = 1;
    PROCESS_SUCCEEDED = 2;
    PROCESS_FAILED = 3;
    PUBLISHED = 4;
  }
  string version = 1;
  Status status = 2;
  string wasm_uri = 3;
  string commit_hash = 4;
  google.protobuf.Timestamp create_time = 5;
}

message NFT {
  string id = 1;
  string token_id = 2;
  Collection collection = 3;
  float min_price = 4;
  google.protobuf.Timestamp mint_time = 5;
}

message CreateCollectionRequest {
  string display_name = 1;
  string description = 2;
  string cover_file_id = 3;
  // the HTTPS URI of the GitHub repository
  string github_repo_uri = 4;
  // TOOD: consider using OAuth2 instead
  string github_access_token = 5;
}

message GetCollectionRequest {
  string name = 1;
}

message ListCollectionsRequest {
  enum Channel {
    CHANNEL_UNSPECIFIED = 0;
    TOP_MINTED = 1;
  }
  Channel channel = 1;
  int32 limit = 2;
  int32 offset = 3;
}

message ListCollectionsResponse {
  repeated Collection collections = 1;
  int32 total = 2;
}

message UpdateCollectionRequest {
  string collection_id = 1;
  string name = 2;
  string display_name = 3;
  string description = 4;
  string cover_file_id = 5;
}

message SyncCollectionOnChainDataRequest {
  string collection_id = 1;
  string collection_name = 2;
  io.candysea.common.types.Chain chain = 3;
  string contract_address = 4;
  float price = 5;
  int32 supply_count = 6;
  string transaction_hash = 7;
}

message ListReleasesRequest {
  string collection_id = 1;
  string collection_name = 2;
  int32 limit = 3;
  int32 offset = 4;
}

message ListReleasesResponse {
  repeated Release releases = 1;
  int32 total = 2;
}

message ListNFTsRequest {
  string collection_name = 1;
  int32 limit = 2;
  int32 offset = 3;
}

message ListNFTsResponse {
  repeated NFT nfts = 1;
  int32 total = 2;
}

message GetNFTRequest {
  string token_id = 2;
}
